pipeline {
  agent any
  stages {
    stage('Code Check') {
      steps {
        git(url: 'https://github.com/modestasd/docker-jenkins-test', branch: 'main')
      }
    }

    stage('Log Files') {
      steps {
        sh 'ls -la'
      }
    }

    stage('Push to Docker') {
      steps {
        sh '''aws ecr --region eu-north-1 | docker login -u AWS -p eyJwYXlsb2FkIjoiejdjTWdwRU94dFFLOGtHdjhWN2llMm1RelAwcng4UW5XMk9xUDBHeFNxTUtGRnpRVmNyZ3p2NFYvRWROZWh1N1ZTVWJ5ajJFaFpFdHQrUmJwWVJuN2RuMmRiNElGbGl1Q0FBb1dWeHV2cDU5N2ZnbHFCb2xacHVBQmFkRUE2S1dsaWFBVXBkc2hCZUgrYUlrVUFETVJNWGY1OTU2VG1TMVdhUHBwWHB6T1puamFlWjRFbHVnNUtYNWx0QWI1NVhnOWJQZUJVTmJRZHlGd3lWci9xZXVEU1JjVzJTejdrMm5wN09yQ2hkd3c1NU90T1ovbFoyOCs1bXdTWkhteUUyVkh6OSs5WTFwTzVJWkdiTlVXLzkwOXFkdXIvbjZqazZNQ084NHM4NE9zUEovcHlxc29IMytHNE83Vzl5T1ljcEJtcFdtcTlTTVFGWStQMi9zemo1MkF3eU52L0RIUXZCN044ajNwa2VFZ0dKcTIrc0IzM1RrZkdTL1VtRzNZYVdEaFN3UHhTOVB5ZktNSCtqc092c1hNdmxaSlFUczBWSTNVYlZlVkJ3a1ErN0NPMGhlRTBrUWhxbUkyblh4NmtoMGxvV2NPMHZWdXFNTHBIVU9PamJUMXBXMlhVU0pndytHVndyWG5udFpvckR4VytHUTRHT3ZvaTgvSHlQdll6WlQvWkpUbTZOVHo2V1hTOWEybmdOamNzNDhWQlFjSUh6SDNhVDVoV0FQNUcvMXNsVGk5ckx0SHFybjJBQkRuR3duQWZEdVRHbjA1ZmFVVXd6OUp3ZGJiOVdya09CRVhLWEc2WGIwcVJRbiszK3lkdHllS1MyYWJtby9LYzB3WHMxK3RZZUk2Y0NkbFJGM0JkenhqRXB0U01GTUY0Q1czY1ZsTUhaMGJoYXNYM3RwRkxkSWlCd0xEU1h0bEJvVDlUWUNObXVuQXAzdkFNR0R5UUhkTVlZTnZENHFrVzdWY2RhVTNHU3krNjNZV1IzWHQzOEQwcmY3cVNTdFkveUhuRVBRWHErME9yL1hLL3J0c2h2NTA1T2lpWmpMaGswTGR0RnFnV2gwNVhTZjZMbXhPTXRWOU1KRSt4UCt6YXlqR2djWUJaMVFWUUJIWE1WNm1CcHRBWUlCc1NabC9ic2x5REtid0Y4STFiYjhBVk9OVjkvUEl1V1dna0hUeXFYeHJuQnd3cUVLeWQ3QXFkUVhUMUZFb081MHErVzV0VlQrbXhMN3Z2dWw1S09DcS9qMTBlS2hISDBrc0FobitxWGhOT3I1RjBFSi9MdWtsMEhzRG5nMjRKR2Q4dHo1aklaSkRCRTVaaGlESEdPZ3oxVXQwM1JSSUpVRzRMQTVoWEhxR0RIY1hKNGlCOUIvZWZmS2dSWkFxLytFSUQvTzBnSlYwN2o5SGczSXJZMD0iLCJkYXRha2V5IjoiQVFJQkFIaGZyRlEyYUlJd0Y1VmM3OVJIRVBHbmNVV3VyMi9Kek04dC9aem9FdFJyQWdIbG1uajR3ZEdQY0h4MVg5a1N1QTMyQUFBQWZqQjhCZ2txaGtpRzl3MEJCd2FnYnpCdEFnRUFNR2dHQ1NxR1NJYjNEUUVIQVRBZUJnbGdoa2dCWlFNRUFTNHdFUVFNMDlxdHJYeGl0M2FUTUJvOUFnRVFnRHVOL0JMcTR5dDhKbFZMTG5mQThMR0FNLy84dXgraEJybUJXdUJPQWxoL0JhOFRLS21WTzJONjRjUWliU01uOGJURGN0UytTd0hadTVGdWl3PT0iLCJ2ZXJzaW9uIjoiMiIsInR5cGUiOiJEQVRBX0tFWSIsImV4cGlyYXRpb24iOjE3MDUyMTY1NTR9 712197371119.dkr.ecr.eu-north-1.amazonaws.com
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build
docker tag node-docker-node-app 712197371119.dkr.ecr.eu-north-1.amazonaws.com/docker-test:latest
docker push 712197371119.dkr.ecr.eu-north-1.amazonaws.com/docker-test:latest'''
      }
    }

  }
}